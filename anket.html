<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Optik Form Oluşturucu v2.0 (Yazdırılabilir)</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #e5e7eb; /* gray-200 */
        }
        /* Yazdırma sırasında görünmemesi gereken elementler için */
        .no-print {
            display: block;
        }
        /* A4 Kağıt Stili */
        #a4-sheet {
            width: 100%;
            aspect-ratio: 210 / 297; /* A4 aspect ratio */
            background-color: white;
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
            padding: 2rem 1.5rem;
            margin: auto;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        .option-bubble {
            width: 28px;
            height: 28px;
            border: 1.5px solid #9ca3af; /* gray-400 */
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            color: #4b5563; /* gray-600 */
            cursor: pointer;
            transition: all 0.15s ease-in-out;
            user-select: none;
        }
        .option-bubble:hover {
            background-color: #f3f4f6; /* gray-100 */
            border-color: #3b82f6; /* blue-500 */
        }
        .option-bubble.selected {
            background-color: #1f2937; /* gray-800 */
            color: white;
            border-color: #1f2937; /* gray-800 */
        }
        .question-row {
            display: flex;
            align-items: center;
            gap: 0.75rem; /* space-x-3 */
            padding: 4px 0;
        }
        .question-number {
            font-weight: 600;
            color: #374151; /* gray-700 */
            width: 30px;
            text-align: right;
        }

        /* Yazdırma Medya Sorgusu */
        @media print {
            body {
                background-color: white;
                margin: 0;
                padding: 0;
            }
            .no-print, .no-print * {
                display: none !important;
            }
            #print-container {
                padding: 0;
                margin: 0;
            }
            #a4-sheet {
                box-shadow: none;
                border: none;
                width: 100%;
                height: 100vh; /* Tam sayfayı kaplaması için */
                padding: 1.5cm; /* Yazıcı kenar boşlukları için */
                margin: 0;
                aspect-ratio: auto;
            }
        }
    </style>
</head>
<body class="p-4 md:p-8">
    <div class="max-w-screen-xl mx-auto">
        
        <header class="text-center mb-8 no-print">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-800">Optik Form Oluşturucu v2.0</h1>
            <p class="text-gray-600 mt-2">Formu özelleştirin, canlı önizleyin, cevapları işaretleyin ve çıktısını alın.</p>
        </header>

        <main class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            
            <!-- AYARLAR PANELİ (SOL) -->
            <div id="settings-panel" class="lg:col-span-1 bg-white p-6 rounded-xl shadow-md h-fit no-print">
                <h2 class="text-2xl font-semibold text-gray-700 border-b pb-3 mb-6">Ayarlar</h2>
                <div class="space-y-5">
                    <div>
                        <label for="formBasligi" class="block text-sm font-medium text-gray-700 mb-1">Form Başlığı</label>
                        <input type="text" id="formBasligi" class="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 transition" value="Memnuniyet Anketi">
                    </div>
                    <div>
                        <label for="kurumAdi" class="block text-sm font-medium text-gray-700 mb-1">Kurum Adı / Ders Adı</label>
                        <input type="text" id="kurumAdi" class="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 transition" value="Örnek Okulları">
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label for="soruSayisi" class="block text-sm font-medium text-gray-700 mb-1">Soru Sayısı</label>
                            <input type="number" id="soruSayisi" min="1" max="100" value="20" class="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 transition">
                        </div>
                        <div>
                            <label for="secenekSayisi" class="block text-sm font-medium text-gray-700 mb-1">Seçenek Sayısı</label>
                            <select id="secenekSayisi" class="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 transition">
                                <option value="5">5 (A-E)</option>
                                <option value="4">4 (A-D)</option>
                                <option value="3">3 (A-C)</option>
                            </select>
                        </div>
                    </div>
                    <div class="border-t pt-5 space-y-3">
                         <button id="clearBtn" class="w-full bg-yellow-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-yellow-600 transition-all">Cevapları Temizle</button>
                        <button id="indirBtn" class="w-full bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700 transition-all">.FMT Cevap Anahtarını İndir</button>
                        <button id="printBtn" class="w-full bg-green-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-green-700 transition-all">Formu Yazdır</button>
                    </div>
                </div>
            </div>

            <!-- A4 ÖNİZLEME PANELİ (SAĞ) -->
            <div id="print-container" class="lg:col-span-2">
                <div id="a4-sheet">
                    <!-- Form Başlığı -->
                    <header id="form-header" class="text-center border-b-2 border-black pb-2 mb-4">
                        <!-- JS ile doldurulacak -->
                    </header>
                    
                    <!-- Öğrenci Bilgileri -->
                    <section id="student-info" class="grid grid-cols-2 gap-x-4 gap-y-2 mb-4 border border-black p-2">
                        <div class="border-b border-gray-400"><strong>Ad Soyad:</strong></div>
                        <div class="border-b border-gray-400"><strong>Numara:</strong></div>
                        <div class="col-span-2 border-b border-gray-400 pb-2"><strong>İmza:</strong></div>
                    </section>

                    <!-- Cevap Alanı -->
                    <section id="answer-area" class="flex-grow">
                        <div id="answer-grid" class="grid grid-cols-2 md:grid-cols-3 gap-x-4">
                            <!-- JS ile doldurulacak -->
                        </div>
                    </section>
                </div>
            </div>

        </main>
    </div>

    <script>
        // DOM Elementleri
        const inputs = {
            formBasligi: document.getElementById('formBasligi'),
            kurumAdi: document.getElementById('kurumAdi'),
            soruSayisi: document.getElementById('soruSayisi'),
            secenekSayisi: document.getElementById('secenekSayisi'),
        };
        const buttons = {
            clearBtn: document.getElementById('clearBtn'),
            indirBtn: document.getElementById('indirBtn'),
            printBtn: document.getElementById('printBtn'),
        };
        const areas = {
            formHeader: document.getElementById('form-header'),
            answerGrid: document.getElementById('answer-grid'),
        };

        const secenekHarfleri = ['A', 'B', 'C', 'D', 'E'];

        // FORMU OLUŞTURAN ANA FONKSİYON
        function generateForm() {
            // Değerleri al
            const formBasligi = inputs.formBasligi.value || "Başlıksız Form";
            const kurumAdi = inputs.kurumAdi.value || "Kurum Belirtilmedi";
            const soruSayisi = parseInt(inputs.soruSayisi.value) || 0;
            const secenekSayisi = parseInt(inputs.secenekSayisi.value);

            // Başlığı güncelle
            areas.formHeader.innerHTML = `
                <h2 class="text-xl font-bold">${kurumAdi.toUpperCase()}</h2>
                <h1 class="text-2xl font-bold">${formBasligi.toUpperCase()}</h1>
            `;

            // Cevap gridini temizle
            areas.answerGrid.innerHTML = '';
            
            if (soruSayisi <= 0) return;

            // Her soruyu ve seçeneği oluştur
            for (let i = 1; i <= soruSayisi; i++) {
                const row = document.createElement('div');
                row.className = 'question-row';
                
                let optionsHTML = '';
                for (let j = 0; j < secenekSayisi; j++) {
                    const harf = secenekHarfleri[j];
                    optionsHTML += `<div class="option-bubble" data-question="${i}" data-option="${harf}">${harf}</div>`;
                }

                row.innerHTML = `
                    <span class="question-number">${i}.</span>
                    <div class="flex items-center gap-2">${optionsHTML}</div>
                `;
                areas.answerGrid.appendChild(row);
            }

            // Oluşturulan tüm seçeneklere tıklama olayı ekle
            document.querySelectorAll('.option-bubble').forEach(bubble => {
                bubble.addEventListener('click', handleOptionClick);
            });
        }

        // Seçeneğe tıklandığında çalışacak fonksiyon
        function handleOptionClick(event) {
            const clickedBubble = event.currentTarget;
            const question = clickedBubble.dataset.question;
            
            // Aynı sorudaki diğer seçeneklerden 'selected' class'ını kaldır
            document.querySelectorAll(`.option-bubble[data-question="${question}"]`).forEach(b => {
                b.classList.remove('selected');
            });

            // Tıklanan seçeneğe 'selected' class'ını ekle
            clickedBubble.classList.add('selected');
        }

        // CEVAPLARI TEMİZLE
        function clearAnswers() {
            document.querySelectorAll('.option-bubble.selected').forEach(bubble => {
                bubble.classList.remove('selected');
            });
        }
        
        // .FMT İNDİR
        function downloadFmt() {
            const baslik = (inputs.formBasligi.value || "anket").replace(/\s+/g, '-').toLowerCase();
            const soruSayisi = parseInt(inputs.soruSayisi.value);
            
            let fmtIcerik = `[BILGI]\n`;
            fmtIcerik += `ANKET_BASLIGI: ${inputs.formBasligi.value}\n`;
            fmtIcerik += `KURUM_ADI: ${inputs.kurumAdi.value}\n`;
            fmtIcerik += `SORU_SAYISI: ${soruSayisi}\n\n`;
            fmtIcerik += `[CEVAP_ANAHTARI]\n`;

            for (let i = 1; i <= soruSayisi; i++) {
                const selectedOption = document.querySelector(`.option-bubble.selected[data-question="${i}"]`);
                const cevap = selectedOption ? selectedOption.dataset.option : '?';
                fmtIcerik += `${i}:${cevap}\n`;
            }

            const blob = new Blob([fmtIcerik], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${baslik}.fmt`;
            a.click();
            URL.revokeObjectURL(url);
        }

        // FORMU YAZDIR
        function printForm() {
            window.print();
        }

        // Olay Dinleyicileri
        Object.values(inputs).forEach(input => {
            input.addEventListener('input', generateForm);
        });
        buttons.clearBtn.addEventListener('click', clearAnswers);
        buttons.indirBtn.addEventListener('click', downloadFmt);
        buttons.printBtn.addEventListener('click', printForm);
        
        // Sayfa yüklendiğinde ilk formu oluştur
        document.addEventListener('DOMContentLoaded', generateForm);
    </script>
</body>
</html>

